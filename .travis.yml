sudo: false
language: node_js
node_js:
  - "node"

addons:
  chrome: stable

branches:
  only:
    - develop

cache:
  yarn: true

before_install:
  - if [ ! -e "$HOME/.meteor/meteor" ]; then curl https://install.meteor.com | sed s/--progress-bar/-sL/g | /bin/sh; fi
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH=$HOME/.yarn/bin:$PATH

services:
  - docker

before_script:
  # Start X Virtual Frame Buffer for headless testing with real browsers
  - ./.scripts/start-xvfb.sh
  # Install node-gyp for running chimp
  - meteor npm install -g node-gyp node-pre-gyp
  - yarn run lint

script:
  # Run meteor and chimp from node.js
  - travis_retry yarn test
  - ./.scripts/docker_build.sh

env:
  global:
  - DISPLAY=:99.0
  - TEST_MODE: "true"